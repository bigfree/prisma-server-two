# Migration `20201123163432-create-workspace-and-projects`

This migration has been generated by Adam Mik√≥ at 11/23/2020, 5:34:32 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TYPE "Role" ADD VALUE 'PROJECTOWNER'

ALTER TABLE "Workspace" ADD COLUMN     "image" TEXT,
ADD COLUMN     "userId" TEXT NOT NULL

CREATE TABLE "Project" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3),
    "deletedAt" TIMESTAMP(3),
    "userId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_ProjectToUser" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "_ProjectToUser_AB_unique" ON "_ProjectToUser"("A", "B")

CREATE INDEX "_ProjectToUser_B_index" ON "_ProjectToUser"("B")

ALTER TABLE "Project" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ProjectToUser" ADD FOREIGN KEY("A")REFERENCES "Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ProjectToUser" ADD FOREIGN KEY("B")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Workspace" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201121164704-workspace..20201123163432-create-workspace-and-projects
--- datamodel.dml
+++ datamodel.dml
@@ -1,39 +1,57 @@
 datasource db {
   default  = true
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 generator typegraphql {
   provider = "typegraphql-prisma"
-  output   = "../prisma/generated/type-graphql"
+  output   = "../src/prisma/generated/type-graphql"
 }
+// TODO: priprava na workspace
 model Workspace {
-id String @id @default(uuid())
-name String
-slug String @unique
-description String?
-createdAt DateTime @default(now())
-updatedAt DateTime? @updatedAt
-  deletedAt DateTime?
+  id          String    @id @default(uuid())
+  name        String
+  slug        String    @unique
+  description String?
+  image       String?
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime? @updatedAt
+  deletedAt   DateTime?
+  user        User      @relation(fields: [userId], references: [id])
+  userId      String
 }
+model Project {
+  id           String    @id @default(uuid())
+  name         String
+  createdAt    DateTime  @default(now())
+  updatedAt    DateTime? @updatedAt
+  deletedAt    DateTime?
+  projectOwner User      @relation("ProjectOwner", fields: [userId], references: [id])
+  userId       String
+  users        User[]
+}
+
 model User {
-  id        String    @id @default(uuid())
-  email     String    @unique
-  name      String?
-  password  String
-  createdAt DateTime  @default(now())
-  updatedAt DateTime? @updatedAt
-  deletedAt DateTime?
-  role      Role      @default(USER)
-  tasks     Task[]
+  id         String      @id @default(uuid())
+  email      String      @unique
+  name       String?
+  password   String
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime?   @updatedAt
+  deletedAt  DateTime?
+  role       Role        @default(USER)
+  tasks      Task[]
+  workspaces Workspace[]
+  projects   Project[]
+  project    Project[]   @relation("ProjectOwner")
 }
 model Task {
   id        String    @id @default(uuid())
@@ -55,8 +73,9 @@
   tasks     Task[]   @relation(references: [id])
 }
 enum Role {
-    USER
-    WORKSPACEADMIN
-    WORKSPACEOWNER
-}
+  USER
+  PROJECTOWNER
+  WORKSPACEADMIN
+  WORKSPACEOWNER
+}
```


